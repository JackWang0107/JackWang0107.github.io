---
title: 数学建模算法1-线性规划
date: 2022-01-01 16:16:29
img: https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/359b033b5bb5c9eab88c9fcdd439b6003af3b3a5
summary: '本文主要讲解了数学建模中常见的一类问题：线性规划，及其求解'
mathjax: true
categories:
  - 数学建模算法
tags:
  - 线性规划
  - Linear Programming
  - Math Modeling
  - Python
---

> 本文主要讲解了数学建模中常见的一类问题：线性规划，及其求解

<img src="https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/359b033b5bb5c9eab88c9fcdd439b6003af3b3a5" alt="线性规划" style="zoom:150%;" />





# 数学建模算法1-线性规划

线性规划是数学建模中非常常见的一类问题，这类问题的求解算法也是必须要掌握的。本文就在介绍线性规划问题的基础上讲解了如何通过编程进行求解。



## 1. 介绍

在人们的生产实践中，经常会遇到如何利用现有资源来安排生产，以取得最大经济效益的问题。更广泛的，**是在某些变量有约束的条件下，求另外一些以来被约束变量的变量的最大最小值问题**。针对这类问题的求解，形成了数学中的运筹学的一个重要分支——数学规划。而线性规划（Linear Programming，LP）就是数学规划中的一个组分。

> 数学规划是用于求解有约束变量函数的极值问题。而线性规划是数学规划的一部分。

自从1947年G. B. Dantzig提出求解线性规划的算法——单纯形法以来，线性规划在理论上越来越成熟，在实际的运用中也越来越广泛。尤其是计算机的发展使得能够处理成千上万个约束条件和目标变量的线性规划问题之后，线性规划的适用领域越来越广泛，成为了现代管理中经常采用的一种方法。

单纯形算法利用多面体的顶点构造一个可能的解，然后沿着多面体的边走到目标函数值更高的另一个顶点，直至到达最优解为止。虽然这个算法在实际上很有效率，在小心处理可能出现的“循环”的情况下，可以保证找到最优解，但它的最坏情况可以很坏：可以构筑一个线性规划问题，单纯形算法需要问题大小的指数倍的运行时间才能将之解出。事实上，有一段时期内人们曾不能确定线性规划问题是NP完全问题还是可以在多项式时间里解出的问题。

第一个在最坏情况具有多项式时间复杂度的线性规划算法在1979年由前苏联数学家Leonid Khachiyan提出。这个算法建基于非线性规划中Naum Shor发明的椭球法（ellip-soid method），该法又是Arkadi Nemirovski（2003年冯‧诺伊曼运筹学理论奖得主）和D. Yudin的凸集最优化椭球法的一般化。

理论上，“椭球法”在最恶劣的情况下所需要的计算量要比“单形法”增长的缓慢，有希望用之解决超大型线性规划问题。但在实际应用上，Khachiyan的算法令人失望：一般来说，单纯形算法比它更有效率。它的重要性在于鼓励了对内点算法的研究。内点算法是针对单形法的“边界趋近”观念而改采“内部逼近”的路线，相对于只沿着可行域的边沿进行移动的单纯形算法，内点算法能够在可行域内移动。
1984年，贝尔实验室印度裔数学家卡马卡（Narendra Karmarkar）提出了投影尺度法（又名Karmarkar's algorithm）。这是第一个在理论上和实际上都表现良好的算法：它的最坏情况仅为多项式时间，且在实际问题中它比单纯形算法有显著的效率提升。自此之后，很多内点算法被提出来并进行分析。一个常见的内点算法为Mehrotra predictor-corrector method。尽管在理论上对它所知甚少，在实际应用中它却表现出色。

单形法沿着边界由一个顶点移动到“相邻”的顶点，内点算法每一步的移动考量较周详，“跨过可行解集合的内部”去逼近最佳解。当今的观点是：对于线性规划的日常应用问题而言，如果算法的实现良好，基于单纯形法和内点法的算法之间的效率没有太大差别，只有在超大型线性规划中，顶点几成天文数字，内点法有机会领先单形法。
线性规划的求解程式在各种各样的工业最优化问题里被广泛使用，例如运输网络的流量的最优化问题，其中很多都可以不太困难地被转换成线性规划问题。 





## 2. 线性规划的定义

先看一个例子

> 某机床厂能够生产甲、乙两种机床，各自的销售利润为四千和三千元。生产甲机床需要A、B两种机器加工，加工时间分别为2小时每台和1小时每台；生产乙机床需要A、B、C三种机器，加工时间为每种机器各一个小时。若每天A、B、C机器分别只能运行10小时、8小时和7小时。问该厂每天应该生产多少甲、乙机床，才能使得总利润最大？

针对上述问题，求解过程如下：

设该厂生产$x_1$台甲机床，$x_2$台乙机床，总利润为$z$，则上述问题数学模型为
$$
\max_{x_1, x_2} z =4x_1 + 3x_2\\
\begin {cases}
2x_1+x+2&\leq &10\\
x_1+x_2&\leq &8\\
x_2 &\leq &7\\
x_1, x_2 &\geq &0
\end {cases}
$$
上面这个问题中，我们称变量$x_1, x_2$为**决策变量**，称变量$z$为**目标变量**，由于目标变量$z$一般都是决策变量的函数，因此有时候也称目标变量为**目标函数**。而对决策变量做出的限制，即上面的四个不等式，称为**约束条件**。

有了上面的定义后，我们接下来就可以给出线性规划的定义：**称目标函数和约束条件都是线性函数的规划问题为线性规划**

因此，线性规划问题是指在**一组**线性约束的条件下求**一组**线性目标函数最大或最小值的问题。

一般来说，在约束下的决策变量的值域往往是一个连续的区域，因此称所有符合约束的决策变量的值组成的集合称为该问题的**可行域**，记为R。称可行域中每一个元素$\vec x=[x_1,x_2,\cdots,x_n]$为**可行解**。称所有可行解中可以使目标函数达到最大值的可行解为**最优解**





线性规划问题的求解，最关键的步骤其实是如何把具体的问题抽象成一个线性规划问题。实际建模的时候，一般不会出现像上面这样如此明显的问法。此外第二个问题就是决策变量的选择。





## 3. 线性规划的变形

上面说到，线性规划问题的难度不在于求解，而在于将问题转变为一个线性规划问题。因此下面介绍一些常见的线性规划问题的变形



### A. 非线性目标函数——换元

在一些情况下，目标函数虽然不是线性的，但是可以通过换元的方法实现转换。例如下面的线性规划模型
$$
\max_{x_1, x_2, \cdots, x_n} z = |x_1| + |x_2| + \cdots + |x_n|\\
\begin {cases}
a_1 x_1 + a_2x_2 + \cdots + a_nx_n &\leq & a\\
b_1 x_1 + b_2x_2 + \cdots + b_nx_n &= & b
\end {cases}
$$
为此，设$x_i=u_i-v_i$,，$|x_i|=u_i+v_i$，则上面的线性规划模型变为
$$
\max_{u_1, \cdots, u_n; v_1, \cdots, v_n} z = (u_1+\cdots u_n) + (v_1\cdots v_n)\\
\begin {cases}
(a_1 u_1 + \cdots + a_nu_n) - (a_1 v_1 + \cdots + a_nv_n) &\leq & a\\
(b_1 u_1 + \cdots + b_nu_n) - (b_1 v_1 + \cdots + b_nv_n) &= & b\\
u1+v_1,\ \ \  \cdots,\ \ \  u_n+v_n &> &0
\end {cases}
$$
则转化为一个标准的线性规划问题





## 4. 线性规划问题的公式化/向量化

对线性规划问题进行向量化（表达成矩阵形式）之后，我们能够进一步的利用各种数学工具对其进行求解。

对于决策变量，用一个列向量表示$\vec x=[x_1, x_2, \cdots，x_n]^T$；由于目标变量可能有多个，因此也用一个向量表示目标向量$\vec c=[c_1, c_2,\cdots, c_n]$。则目标函数的系数可以用一个矩阵$C$来表示:
$$
\begin {aligned}
\vec c &= C^T \times \vec x \\
& = 
\begin {bmatrix}
c_{11} & c_{12} & \cdots & c_{1n}\\
c_{21} & c_{22} & \cdots & c_{2n}\\
\vdots & \vdots & \ddots & \vdots\\
c_{n1} & c_{n2} & \cdots & c_{nn}
\end {bmatrix} \times \vec x
\end{aligned}
$$
接下来对约束条件进行向量化。约束条件其实可以分为三类，第一类是$\leq$类型的（即$A\vec x\leq \vec b$），第二类是$=$类型的（即$A_{eq}\vec x\leq b_{eq}$），第三类是约定变量范围的（即$\vec{lb}\leq\vec x \leq\vec{ub}$）

因此，整个线性规划问题的向量形式（标准形式）如下：
$$
\max_{\vec x} \vec z = C^T \vec x\\
\begin {cases}
A\vec x &\leq &\vec b\\
A_{eq} \vec x & = & \vec b_{eq}\\
\vec {lb} &\leq &\vec x &\leq &\vec {ub}
\end {cases}
$$
因此，稍后用程序求解线性规划问题的时候，所需要的变量就是：$\vec C$、$\vec A$、$\vec b$、$\vec A_{eq}$、$\vec b_{eq}$、$\vec {lb}$、$\vec {ub}$





## 5. 线性规划Python求解

对于线性规划问题，对其求解办法的研究和利用线性规划求解问题是两回事。对于数学建模来说，我们其实只需要利用线性规划去求解问题即可，并不需要花费很多的时间在研究线性规划求解方法的学习上，毕竟求解线性规划问题的算法已经有很多了。其实不仅仅对于线性规划，后面讲解的诸多问题，我们只需要掌握求解方法即可，而不用过分深入求解原理。

Python中使用`scipy`库中的`optimize`模块中的`linprog`函数求解

注：以下内容参考[scipy官方的linprog文档](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linprog.html)（https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linprog.html）

<img src="https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101191341829.png" alt="SciPy的官方文档" style="zoom:50%;" />



可以看到，对于 $\leq$类型，SciPy的变量名是ub（upper bound），$=$则是eq，范围则是$bounds$

<img src="https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101191536675.png" alt="需要用到的参数" style="zoom:50%;" />

需要注意的就是bounds的格式，bounds是一个元组对的列表，第一个元素是下限，第二个元素是上限，若没有上限/下限则为None。

此外，由于约束条件中不一定三种类型都有，因此如果没有的话指定为None即可

最后的返回值是 scipy.optimize.OptimizeResult对象，可用的属性如下

<img src="https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101192003430.png" alt="返回对象的属性" style="zoom: 67%;" />

需要注意的是，返回的最优结果是最小值，因此我们如果要求最大值要给$C$矩阵取反

下面给出一个例子

![线性规划求解的例子](https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101195241900.png)

```python
import numpy as np
import scipy.optimize
import scipy.optimize as scopt

c = np.array([-2, -3, 5])
A = np.array([-2, 5, -1, 1, 3, 1]).reshape(2, -1)
b = np.array([-10, 12])
A_eq = np.ones(shape=(1, 3))
B_eq = 7
bounds = [[0, None], [0, None], [0, None]]

result: scipy.optimize.OptimizeResult = scopt.linprog(c=c, A_ub=A, b_ub=b, A_eq=A_eq, b_eq=B_eq, bounds=bounds)
print(f"min value of z: {result.fun}")
print(f"corresponding xs: {result.x}")
print()
print(result)
```

![运行结果](https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101193044389.png)







## 6. 线性规划建模例子

最后以一个mini-数学建模的例子来结尾，这个例子就是使用线性规划求解的。

### A. 最优投资问题

​	市场上有$n$种资产$s_i,\ i=1, 2, \cdots ,n$可以选择。现用数额为$M$的资金来进行一个时期的投资。在这一时期内购买资产$s_i$的平均收益率为$r_i$，风险损失率为$q_i$。此外，投资越分散，总的风险越少，而总风险可用所有购买的资产的风险中的最大的一个风险来度量。

​	购买资产$s_i$时要付交易费，费率为$p_i$;，当购买额不超过给定值$u_i$（$M\gg u_i$）时，交易费率按购买额为$u_i$计算。另外，假定同期银行存款利率是$r_0$，存银行既无交易费又无风险（设$r_0= 5%$）。

​	n= 4时相关数据如下表。

<img src="https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101195640092.png" alt="表1.1" style="zoom:50%;" />

​	试给该公司设计一种投资组合方案，即用给定资金$M$，有选择地购买若干种资产或存银行生息，使净收益尽可能大，使总体风险尽可能小。 





### B. 符号规定

对问题做出如下的符号规定

- 设$s_i$表示第$i$种投资项目，如股票、债券等。则$i=0, 1, 2, \cdots, n$，其中$s_0$表示存入银行
- $r_i$， $p_i$， $q_i$分别表示资产$s_i$的平均收益、交易费率以及风险损失，其中$r_0=0.05$，$p_0=0$，$q_0=0$
- $u_i$表示交易$s_i$时候的费率
- $x_i$表示投资$s_i$的金额
- $a$表示投资的总风险
- $Q$表示总收益





### C. 基本假设

1. 为便于计算，假设$M=1$
2. 投资越分散，总风险越小
3. 总风险用购买的$s_i$中最大的一项描述
4. $n+1$种资产$s_i$之间的风险$q_i$是独立的
5. 在投资期间内，$r_i$，$p_i$，$q_i$保持为定值，不受外界因素影响
6. 净收益和总体风险只受$r_i$，$p_i$，$q_i$影响，不受其他因素影响



### D. 模型分析与建立

模型的总风险即指投资组可能的损失，因此
$$
a=\max\{q_ix_i| i=1,\cdots,n\}
$$
此外，进行交易的时候购买资产`s_i`所指出的交易费用为一分段函数
$$
\begin {cases}
p_i u_i, & x_i \leq u_i\\
p_i x_i, & x_i \ge u_i
\end {cases}
$$
考虑到购买资产$s_i$时候的收益$r_i$，且$M\gg u_i$，则购买资产$s_i$产生的净收益为

$$
Q_i=(r_i-p_i)x_i
$$
目标是使收益尽可能大，同时风险尽可能小，因此是一个多目标规划的模型，优化目标如下
$$
\begin {cases}
\max (\sum_{i=0}^n (r_i-p_i)x_i)\\
\min \max ({q_ix_i})
\end {cases}
$$
约束条件为
$$
\begin{cases}
\sum_{i=0}^n (1+p_i)x_i = M, & i=0, \cdots,n\\
x_i \ge 0, & i=0,\cdots,n
\end{cases}
$$
考虑到不同投资者在投资时的偏好不同，因此有如下三类模型：

#### 1. 模型一：固定风险，优化收益

设投资损失的上界$l$作为投资者能够承担的最大单笔损失比例，则投资者的损失比例$\frac{q_ix_i}{M}\leq l$

此时，在加强的约束下，模型退化为
$$
\max_{x_0,\cdots,x_n}\sum_{i=0}^n(r_i-p_i)x_i\\
\begin{cases}
\frac{q_ix_i}{M} \leq l\\
\sum_{i=0}^n(1+p_i)x_i=M, & i=0,\cdots, n\\
x_i \ge0, & i=0,\cdots,n
\end{cases}
$$

#### 2. 模型二：固定收益，最小化风险

设投资者的收益固定为$k$，则模型退化为
$$
\min\max{q_ix_i}\\
\begin {cases}
\max (\sum_{i=0}^n (r_i-p_i)x_i \ge k\\
\sum_{i=0}^n(1+p_i)x_i=M, & i=0,\cdots, n\\
x_i \ge0, & i=0,\cdots,n
\end{cases}
$$

#### 3. 模型三：收益与风险平衡

投资者在权衡风险和收益的时候，不同的投资者会有不同的偏好，因此对风险和收益赋予权重$s$，称为投资偏好系数。则此时模型为
$$
\min(s\cdot \max{q_ix_i}-(1-s)\cdot\sum_{i=0}^n(r_i-p_i)x_i)\\
\begin {cases}
0\leq s\leq 1\\
\sum_{i=0}^n(1+p_i)x_i=M, & i=0,\cdots, n\\
x_i \ge0, & i=0,\cdots,n
\end{cases}
$$


### E. 模型求解

下面针对上述三个模型进行求解

#### A. 模型一

注意第一个约束条件是两个向量的哈达马积
$$
\min_{[x_0,\cdots,x_n]} -[0.05, 0.27, 0.19, 0.185, 0.185][x_0, x_1, x_2, x_3, x_4, x_5]^T\\
\begin{cases}
\max [0, 0.025 0.015 0.055, 0.026][x_0, x_1, x_2, x_3, x_4, x_5] \leq l\\
[1, 1.01, 1.02, 1.045, 1.065][x_0, x_1, x_2, x_3, x_4, x_5]^T=1\\
x_0, x_1, x_2, x_3, x_4 \ge0
\end{cases}
$$
$l$为求解时候变量，因此对其进行搜索，从$l$从0~0.05，即损失本金的5%

```python
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import scipy.optimize as scoptim
from typing import *

r = np.array([5, 28, 21, 23, 25], dtype=float) * 0.01
q = np.array([0., 2.5, 1.5, 5.5, 2.6], dtype=float) * 0.01
p = np.array([0., 1, 2, 4.5, 6.5], dtype=float) * 0.01


def model1():
    global r, p, q
    c = -(r - p)
    A_eq = (1 + p).reshape(1, -1)
    b_eq = 1
    A_ub = np.repeat(q.reshape(1, -1), repeats=5, axis=0) * np.eye(N=5)
    bounds = [(0, None)] * 5
    results: List[scoptim.OptimizeResult] = []
    for i in (x := np.arange(start=0, stop=0.05, step=1e-3)):
        b_ub = np.ones(shape=5) * i
        results.append(scoptim.linprog(c=c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds))
    plt.plot(x, [-1 * x.fun for x in results], "o-", label="max profit - risk")
    plt.xlabel("risk")
    plt.ylabel("profit")
    plt.legend()
    plt.show()


if __name__ == "__main__":
    print(model1())
```

![Results](https://jack-1307599355.cos.ap-shanghai.myqcloud.com/img/image-20220101224009040.png)

可以看出来：

- 风险越大，收益越大，损失本金的5%最高可以达到超过本金25%的收益
- 在当前五种投资资产中，收益——风险曲线最终收敛到0.25左右，意味着当前投资策略的潜力如此
- $l=0.006$附近有一个转折点，转折点左侧风险增加缓慢但是收益增加显著，而右侧则风险增加很多并且收益增加不多（5%的额外收益）。所以对于风险和收益没有特殊偏好的投资者来说，应该选择曲线的转折点作为最优投资组合，大约是$l=0.6%，Q=20%$，所对应投资方案为 风险度$u=0.006$，收益$Q=0.2019$，$x_0=0$，$x_1=0.24$，$x_2=0.4$，$x_3=0.1091$，$x_4=0.2212$。



#### B. 模型二、三

$$
\min\max{[0, 0.025 0.015 0.055, 0.026][x_0, x_1, x_2, x_3, x_4, x_5]}\\

\begin {cases}
 [0.05, 0.27, 0.19, 0.185, 0.185][x_0, x_1, x_2, x_3, x_4, x_5]^T \ge k\\
[1, 1.01, 1.02, 1.045, 1.065][x_0, x_1, x_2, x_3, x_4, x_5]^T=1\\
x_0, x_1, x_2, x_3, x_4 \ge0
\end{cases}
$$

模型二和模型三其实有一个问题，就是目标函数不是一个线性的，因为存在去max这一步，所以实际上是一个分段函数这是由于取最大风险的才导致的不连续。所以这里就不给出解答了。如果想要做出来的话，改一下目标函数

